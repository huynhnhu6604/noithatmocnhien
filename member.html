<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Tài khoản - Nội thất Mộc Nhiên</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
        
        <!-- Firebase SDK -->
        <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
        
        <!-- Sweetalert2 -->
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box; 
            }
            body {
                font-family: 'Montserrat', sans-serif;
                background-color: #f9f7f3;
            }
            .header-top {
                display: flex;
                align-items: center;
                justify-content: center;
                background-color: #5a3d2b;
                padding: 18px 0 12px 0;
                box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            }
            .logo {
                width: 90px;
                height: 90px;
                margin-right: 18px;
                border-radius: 60%;
                border: 3px solid #e9c46a;
                box-shadow: 0 0 15px rgba(233, 196, 106, 0.6);
                transition: transform 0.3s, box-shadow 0.3s;
                object-fit: cover;
            }
            .logo:hover {
                transform: scale(1.05);
                box-shadow: 0 0 20px rgba(233, 196, 106, 0.8);
            }
            .store-name {
                font-family: 'Great Vibes', cursive;
                font-size: 2.7rem;
                font-weight: 400;
                color: #e9c46a;
                text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
                letter-spacing: 1.5px;
            }
            .header-nav {
                width: 100%;
                background-color: #4a3322;
                box-shadow: 0 2px 8px rgba(0,0,0,0.04);
                display: flex;
                justify-content: center;
            }
            .nav-links {
                display: flex;
                align-items: center;
                gap: 10px;
                flex-wrap: wrap;
                justify-content: center;
                padding: 0 10px;
                min-height: 48px;
            }
            .nav-btn {
                font-family: 'Montserrat', sans-serif;
                text-decoration: none;
                color: #f9f7f3;
                font-weight: 500;
                padding: 8px 12px;
                border-radius: 5px;
                transition: all 0.3s;
                border: 1px solid transparent;
                letter-spacing: 0.5px;
                text-transform: uppercase;
                font-size: 0.75rem;
                position: relative;
                white-space: nowrap;
            }
            .nav-btn:hover {
                background-color: rgba(233, 196, 106, 0.2);
                border-color: #e9c46a;
            }
            .active {
                background-color: rgba(233, 196, 106, 0.2);
                border: 1px solid #e9c46a;
            }
            
            /* Dropdown menu */
            .dropdown {
                position: relative;
            }
            .mega-menu {
                display: none;
                position: absolute;
                left: 0;
                top: 100%;
                background: #fff;
                box-shadow: 0 8px 24px rgba(0,0,0,0.15);
                padding: 24px 32px;
                display: flex;
                gap: 40px;
                z-index: 100;
                min-width: 800px;
                opacity: 0;
                visibility: hidden;
                transform: translateY(10px);
                transition: all 0.3s ease;
            }
            .dropdown:hover .mega-menu {
                display: flex;
                opacity: 1;
                visibility: visible;
                transform: translateY(0);
            }
            .mega-column {
                display: flex;
                flex-direction: column;
                min-width: 160px;
                margin-right: 24px;
            }
            .mega-menu a {
                color: #555;
                padding: 8px 0;
                text-decoration: none;
                font-size: 0.9rem;
                transition: all 0.2s;
                border-bottom: 1px solid transparent;
            }
            .mega-menu a:hover {
                color: #e9c46a;
                border-bottom: 1px solid #e9c46a;
                transform: translateX(5px);
            }
            
            /* Thêm mũi tên cho dropdown */
            .dropdown > .nav-btn::after {
                content: '▼';
                font-size: 0.7em;
                margin-left: 5px;
                display: inline-block;
                transition: transform 0.3s;
            }
            .dropdown:hover > .nav-btn::after {
                transform: rotate(180deg);
            }
            
            /* Nút giỏ hàng */
            .cart-btn {
                display: flex;
                align-items: center;
                gap: 10px;
                color: #d9d1cc;
                padding: 8px 12px;
                border-radius: 5px;
                text-decoration: none;
                transition: all 0.3s;
                font-weight: 600;
                margin-left: 10px;
                font-size: 0.75rem;
            }
            .cart-icon {
                font-size: 2rem;
            }
            .cart-btn:hover {
                background: #d4b054;
                transform: translateY(-2px);
            }
            
            /* Style cho nút đăng nhập */
            .login-btn {
                display: flex;
                align-items: center;
                gap: 6px;
                color: #5a3d2b;
                padding: 8px 16px;
                border-radius: 5px;
                text-decoration: none;
                transition: all 0.3s;
                font-weight: 600;
                margin-left: 10px;
                font-size: 0.75rem;
                background-color: #e9c46a;
                border: 1px solid #e9c46a;
            }
            .login-btn:hover {
                background-color: #5a3d2b;
                color: #e9c46a;
                transform: translateY(-2px);
            }

            /* Style cho user menu */
            .user-menu {
                display: flex;
                align-items: center;
                gap: 6px;
                color: #5a3d2b;
                padding: 8px 16px;
                border-radius: 5px;
                text-decoration: none;
                transition: all 0.3s;
                font-weight: 600;
                margin-left: 10px;
                font-size: 0.75rem;
                background-color: #e9c46a;
                border: 1px solid #e9c46a;
            }

            .user-menu:hover {
                background-color: #5a3d2b;
                color: #e9c46a;
                transform: translateY(-2px);
            }

            .user-menu .logout-btn {
                margin-left: 10px;
                cursor: pointer;
                padding: 4px 8px;
                border-radius: 4px;
                background: rgba(255,255,255,0.2);
            }

            .user-menu .logout-btn:hover {
                background: rgba(255,255,255,0.3);
            }

            /* Member Page Styles */
            .member-container {
                max-width: 1200px;
                margin: 40px auto;
                padding: 0 20px;
                display: grid;
                grid-template-columns: 250px 1fr;
                gap: 30px;
            }

            .member-sidebar {
                background: white;
                border-radius: 12px;
                padding: 20px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.08);
                height: fit-content;
            }

            .member-avatar {
                width: 100px;
                height: 100px;
                border-radius: 50%;
                margin: 0 auto 20px;
                display: block;
                border: 3px solid #e9c46a;
            }

            .member-name {
                text-align: center;
                font-size: 1.2rem;
                color: #5a3d2b;
                margin-bottom: 5px;
            }

            .member-email {
                text-align: center;
                color: #666;
                font-size: 0.9rem;
                margin-bottom: 20px;
            }

            .sidebar-menu {
                list-style: none;
            }

            .sidebar-menu li {
                margin-bottom: 10px;
            }

            .sidebar-menu a {
                display: flex;
                align-items: center;
                gap: 10px;
                padding: 10px;
                color: #5a3d2b;
                text-decoration: none;
                border-radius: 6px;
                transition: all 0.3s;
            }

            .sidebar-menu a:hover,
            .sidebar-menu a.active {
                background: #f9f7f3;
                color: #e9c46a;
            }

            .sidebar-menu i {
                font-size: 1.2rem;
            }

            .member-content {
                background: white;
                border-radius: 12px;
                padding: 30px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            }

            .content-header {
                margin-bottom: 30px;
            }

            .content-header h2 {
                font-size: 1.8rem;
                color: #5a3d2b;
                margin-bottom: 10px;
            }

            .content-header p {
                color: #666;
            }

            /* Form Styles */
            .form-group {
                margin-bottom: 20px;
            }

            .form-group label {
                display: block;
                margin-bottom: 8px;
                color: #5a3d2b;
                font-weight: 500;
            }

            .form-control {
                width: 100%;
                padding: 12px;
                border: 1px solid #ddd;
                border-radius: 6px;
                font-size: 1rem;
                transition: all 0.3s;
            }

            .form-control:focus {
                outline: none;
                border-color: #e9c46a;
                box-shadow: 0 0 0 3px rgba(233, 196, 106, 0.2);
            }

            .btn {
                padding: 12px 24px;
                border: none;
                border-radius: 6px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s;
                font-size: 1rem;
            }

            .btn-primary {
                background: #e9c46a;
                color: #5a3d2b;
            }

            .btn-primary:hover {
                background: #5a3d2b;
                color: #e9c46a;
            }

            /* Order History Styles */
            .order-history {
                background: var(--white);
                border-radius: 12px;
                padding: 30px;
                margin-top: 30px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            }

            .order-history h2 {
                color: var(--primary-color);
                font-size: 24px;
                margin-bottom: 20px;
                font-family: 'Playfair Display', serif;
            }

            .order-list {
                display: flex;
                flex-direction: column;
                gap: 20px;
            }

            .order-item {
                background: var(--light-bg);
                border-radius: 8px;
                padding: 20px;
                border: 1px solid var(--border-color);
                transition: all 0.3s ease;
                cursor: pointer;
            }

            .order-item:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            }

            .order-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 15px;
                padding-bottom: 15px;
                border-bottom: 1px solid var(--border-color);
            }

            .order-id {
                font-weight: 600;
                color: var(--primary-color);
            }

            .order-date {
                color: var(--text-color);
                opacity: 0.8;
            }

            .order-status {
                padding: 5px 12px;
                border-radius: 20px;
                font-size: 14px;
                font-weight: 500;
            }

            .status-pending {
                background: #fff3cd;
                color: #856404;
            }

            .status-paid {
                background: #d4edda;
                color: #155724;
            }

            .status-shipping {
                background: #cce5ff;
                color: #004085;
            }

            .status-completed {
                background: #d1e7dd;
                color: #0f5132;
            }

            .status-cancelled {
                background: #f8d7da;
                color: #721c24;
            }

            .order-summary {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
            }

            .summary-item {
                display: flex;
                flex-direction: column;
                gap: 5px;
            }

            .summary-label {
                font-size: 14px;
                color: var(--text-color);
                opacity: 0.8;
            }

            .summary-value {
                font-weight: 500;
                color: var(--text-color);
            }

            .order-total {
                margin-top: 15px;
                padding-top: 15px;
                border-top: 1px solid var(--border-color);
                text-align: right;
                font-weight: 600;
                color: var(--primary-color);
            }

            /* Order Detail Modal Styles */
            .modal {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                z-index: 1000;
                overflow-y: auto;
            }

            .modal-content {
                position: relative;
                background: #ffffff;
                margin: 50px auto;
                padding: 0;
                width: 90%;
                max-width: 800px;
                border-radius: 12px;
                box-shadow: 0 5px 30px rgba(0,0,0,0.15);
                animation: modalSlideIn 0.3s ease;
            }

            @keyframes modalSlideIn {
                from {
                    transform: translateY(-50px);
                    opacity: 0;
                }
                to {
                    transform: translateY(0);
                    opacity: 1;
                }
            }

            .modal-header {
                padding: 20px 30px;
                border-bottom: 1px solid #e0e0e0;
                display: flex;
                justify-content: space-between;
                align-items: center;
                background: linear-gradient(135deg, #5a3d2b 0%, #4a3223 100%);
                color: #ffffff;
                border-radius: 12px 12px 0 0;
            }

            .modal-header h2 {
                font-size: 24px;
                font-family: 'Playfair Display', serif;
                margin: 0;
            }

            .close-button {
                background: none;
                border: none;
                color: var(--white);
                font-size: 24px;
                cursor: pointer;
                padding: 0;
                width: 30px;
                height: 30px;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 50%;
                transition: all 0.3s ease;
            }

            .close-button:hover {
                background: rgba(255,255,255,0.1);
            }

            .modal-body {
                padding: 30px;
                max-height: 70vh;
                overflow-y: auto;
                background: #ffffff;
            }

            .modal-footer {
                padding: 20px 30px;
                border-top: 1px solid #e0e0e0;
                display: flex;
                justify-content: flex-end;
                gap: 15px;
                background: #f5f5f5;
                border-radius: 0 0 12px 12px;
            }

            .order-detail-section {
                background: #ffffff;
                border-radius: 8px;
                padding: 20px;
                margin-bottom: 20px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.05);
                border: 1px solid #e0e0e0;
            }

            .order-detail-section h3 {
                color: var(--primary-color);
                font-size: 18px;
                margin-bottom: 20px;
                font-family: 'Playfair Display', serif;
            }

            .detail-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
            }

            .detail-item {
                display: flex;
                flex-direction: column;
                gap: 5px;
            }

            .detail-label {
                font-size: 14px;
                color: var(--text-color);
                opacity: 0.8;
            }

            .detail-value {
                font-weight: 500;
                color: var(--text-color);
            }

            .product-list {
                margin-top: 20px;
            }

            .product-item {
                display: flex;
                align-items: center;
                gap: 15px;
                padding: 15px;
                border: 1px solid #e0e0e0;
                border-radius: 8px;
                margin-bottom: 10px;
                transition: all 0.3s ease;
                background: #ffffff;
            }

            .product-item:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            }

            .product-image {
                width: 80px;
                height: 80px;
                object-fit: cover;
                border-radius: 4px;
                border: 1px solid var(--border-color);
            }

            .product-info {
                flex: 1;
            }

            .product-name {
                font-weight: 500;
                margin-bottom: 5px;
                color: var(--primary-color);
            }

            .product-price {
                color: var(--primary-color);
                font-weight: 600;
            }

            .product-quantity {
                color: var(--text-color);
                opacity: 0.8;
            }

            .payment-info {
                background: #f5f5f5;
                padding: 20px;
                border-radius: 8px;
                margin-top: 20px;
            }

            .timeline {
                margin-top: 30px;
                position: relative;
                padding-left: 30px;
            }

            .timeline::before {
                content: '';
                position: absolute;
                left: 0;
                top: 0;
                bottom: 0;
                width: 2px;
                background: var(--border-color);
            }

            .timeline-item {
                position: relative;
                margin-bottom: 20px;
            }

            .timeline-item::before {
                content: '';
                position: absolute;
                left: -34px;
                top: 0;
                width: 10px;
                height: 10px;
                border-radius: 50%;
                background: var(--primary-color);
                border: 2px solid var(--white);
            }

            .timeline-date {
                font-size: 14px;
                color: var(--text-color);
                opacity: 0.8;
                margin-bottom: 5px;
            }

            .timeline-content {
                font-weight: 500;
            }

            .btn {
                padding: 12px 24px;
                border: none;
                border-radius: 6px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s;
                font-size: 1rem;
                display: inline-flex;
                align-items: center;
                gap: 8px;
            }

            .btn-primary {
                background: #5a3d2b;
                color: #ffffff;
            }

            .btn-primary:hover {
                background: #4a3223;
                transform: translateY(-2px);
            }

            .btn-secondary {
                background: #f5f5f5;
                color: #5a3d2b;
                border: 1px solid #e0e0e0;
            }

            .btn-secondary:hover {
                background: #e0e0e0;
            }

            @media print {
                body * {
                    visibility: hidden;
                }
                .modal-content,
                .modal-content * {
                    visibility: visible;
                }
                .modal-content {
                    position: absolute;
                    left: 0;
                    top: 0;
                    width: 100%;
                    margin: 0;
                    padding: 20px;
                }
                .modal-header,
                .modal-footer {
                    display: none;
                }
            }

            @media (max-width: 768px) {
                .member-container {
                    grid-template-columns: 1fr;
                }
                
                .member-sidebar {
                    position: sticky;
                    top: 20px;
                }

                .order-history {
                    padding: 20px;
                }

                .modal-content {
                    margin: 20px;
                    width: auto;
                }

                .modal-body {
                    padding: 20px;
                }

                .product-item {
                    flex-direction: column;
                    text-align: center;
                }

                .product-image {
                    width: 120px;
                    height: 120px;
                }

                .modal-footer {
                    flex-direction: column;
                }

                .btn {
                    width: 100%;
                    justify-content: center;
                }
            }
        </style>
    </head>
    <body>
        <div class="header-top">
            <img src="picture/logo.jpg" alt="Mộc Nhiên Logo" class="logo">
            <div class="store-name">Nội thất Mộc Nhiên</div>
        </div>
        <nav class="header-nav">
            <div class="nav-links">
                <a href="index.html" class="nav-btn">Trang chủ</a>
                <div class="dropdown">
                    <a href="products.html" class="nav-btn">Sản phẩm</a>
                    <div class="mega-menu">
                        <div class="mega-column">
                            <a href="products.html?category=Sofa">Sofa</a>
                            <a href="products.html?category=Ghế dài & đôn">Ghế dài & đôn</a>
                            <a href="products.html?category=Bàn nước">Bàn nước</a>
                            <a href="products.html?category=Tủ tivi">Tủ tivi</a>
                            <a href="products.html?category=Kệ trưng bày">Kệ trưng bày</a>
                            <a href="products.html?category=Tủ giày">Tủ giày</a>
                        </div>
                        <div class="mega-column">
                            <a href="products.html?category=Bàn ăn">Bàn ăn</a>
                            <a href="products.html?category=Ghế ăn">Ghế ăn</a>
                            <a href="products.html?category=Ghế Bar">Ghế Bar</a>
                            <a href="products.html?category=Tủ ly">Tủ ly</a>
                            <a href="products.html?category=Tủ bếp">Tủ bếp</a>
                        </div>
                        <div class="mega-column">
                            <a href="products.html?category=Giường ngủ">Giường ngủ</a>
                            <a href="products.html?category=Bàn đầu giường">Bàn đầu giường</a>
                            <a href="products.html?category=Bàn trang điểm">Bàn trang điểm</a>
                            <a href="products.html?category=Tủ áo">Tủ áo</a>
                            <a href="products.html?category=Nệm">Nệm</a>
                        </div>
                        <div class="mega-column">
                            <a href="products.html?category=Bàn làm việc">Bàn làm việc</a>
                            <a href="products.html?category=Ghế làm việc">Ghế làm việc</a>
                            <a href="products.html?category=Kệ sách">Kệ sách</a>
                            <a href="products.html?category=Bàn ngoài trời">Bàn ngoài trời</a>
                            <a href="products.html?category=Ghế ngoài trời">Ghế ngoài trời</a>
                        </div>
                        <div class="mega-column">
                            <a href="products.html?category=Đèn trang trí">Đèn trang trí</a>
                            <a href="products.html?category=Thảm trang trí">Thảm trang trí</a>
                            <a href="products.html?category=Bình trang trí">Bình trang trí</a>
                            <a href="products.html?category=Tranh">Tranh</a>
                            <a href="products.html?category=Gương">Gương</a>
                            <a href="products.html?category=Đồng hồ">Đồng hồ</a>
                            <a href="products.html?category=Tượng trang trí">Tượng trang trí</a>
                            <a href="products.html?category=Dụng cụ bếp">Dụng cụ bếp</a>
                        </div>
                    </div>
                </div>
                <a href="collection.html" class="nav-btn">Bộ sưu tập</a>
                <a href="promotion.html" class="nav-btn">Khuyến mãi</a>
                <a href="member.html" class="nav-btn active">Thành viên</a>
                <a href="policy.html" class="nav-btn">Chính sách</a>
                <a href="about.html" class="nav-btn">Về chúng tôi</a>
                <a href="cart.html" class="cart-btn">
                    <span class="cart-icon">🛒</span>
                    <span>Giỏ hàng</span>
                </a>
                <div id="authButtons">
                    <a href="#" class="login-btn" onclick="showModal('loginModal')">
                        <span>👤</span>
                        <span>Đăng nhập</span>
                    </a>
                </div>
            </div>
        </nav>

        <div class="member-container">
            <div class="member-sidebar">
                <img src="picture/logo.jpg" alt="Avatar" class="member-avatar">
                <h3 class="member-name" id="userName">Loading...</h3>
                <p class="member-email" id="userEmail">Loading...</p>
                
                <ul class="sidebar-menu">
                    <li><a href="#" class="active" onclick="showSection('profile')">
                        <i>👤</i> Thông tin cá nhân
                    </a></li>
                    <li><a href="#" onclick="showSection('orders')">
                        <i>📦</i> Lịch sử đặt hàng
                    </a></li>
                    <li><a href="#" onclick="showSection('address')">
                        <i>📍</i> Địa chỉ giao hàng
                    </a></li>
                    <li><a href="#" onclick="showSection('password')">
                        <i>🔒</i> Đổi mật khẩu
                    </a></li>
                    <li><a href="#" onclick="logout()">
                        <i>🚪</i> Đăng xuất
                    </a></li>
                </ul>
            </div>

            <div class="member-content">
                <!-- Profile Section -->
                <div id="profileSection" class="content-section">
                    <div class="content-header">
                        <h2>Thông tin cá nhân</h2>
                        <p>Cập nhật thông tin cá nhân của bạn</p>
                    </div>
                    <form id="profileForm" onsubmit="updateProfile(event)">
                        <div class="form-group">
                            <label for="fullName">Họ và tên</label>
                            <input type="text" id="fullName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">Số điện thoại</label>
                            <input type="tel" id="phone" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" id="email" class="form-control" disabled>
                        </div>
                        <button type="submit" class="btn btn-primary">Cập nhật thông tin</button>
                    </form>
                </div>

                <!-- Orders Section -->
                <div id="ordersSection" class="content-section" style="display: none;">
                    <div class="content-header">
                        <h2>Lịch sử đặt hàng</h2>
                        <p>Xem lại các đơn hàng của bạn</p>
                    </div>
                    <div class="order-history">
                        <div class="order-list" id="orderList">
                            <!-- Orders will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Address Section -->
                <div id="addressSection" class="content-section" style="display: none;">
                    <div class="content-header">
                        <h2>Địa chỉ giao hàng</h2>
                        <p>Quản lý địa chỉ giao hàng của bạn</p>
                    </div>
                    <form id="addressForm" onsubmit="updateAddress(event)">
                        <div class="form-group">
                            <label for="address">Địa chỉ</label>
                            <input type="text" id="address" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="city">Thành phố</label>
                            <input type="text" id="city" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="district">Quận/Huyện</label>
                            <input type="text" id="district" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Cập nhật địa chỉ</button>
                    </form>
                </div>

                <!-- Password Section -->
                <div id="passwordSection" class="content-section" style="display: none;">
                    <div class="content-header">
                        <h2>Đổi mật khẩu</h2>
                        <p>Cập nhật mật khẩu của bạn</p>
                    </div>
                    <form id="passwordForm" onsubmit="updatePassword(event)">
                        <div class="form-group">
                            <label for="currentPassword">Mật khẩu hiện tại</label>
                            <input type="password" id="currentPassword" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="newPassword">Mật khẩu mới</label>
                            <input type="password" id="newPassword" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">Xác nhận mật khẩu mới</label>
                            <input type="password" id="confirmPassword" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Đổi mật khẩu</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Modal Chi tiết đơn hàng -->
        <div class="modal" id="orderDetailModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Chi tiết đơn hàng</h2>
                    <button class="close-button" onclick="closeModal('orderDetailModal')">&times;</button>
                </div>
                <div class="modal-body" id="orderDetailContent">
                    <!-- Order details will be loaded here -->
                </div>
            </div>
        </div>

        <script>
            // Cấu hình Firebase
            const firebaseConfig = {
                apiKey: "AIzaSyBHTL0ZIZkmRNi7kRF8UJdjR1qhx8cdre4",
                authDomain: "webnoithat-de11f.firebaseapp.com",
                databaseURL: "https://webnoithat-de11f-default-rtdb.firebaseio.com",
                projectId: "webnoithat-de11f",
                storageBucket: "webnoithat-de11f.firebasestorage.app",
                messagingSenderId: "919918511984",
                appId: "1:919918511984:web:d1b260dc52102fd279b1b5",
                measurementId: "G-H1G2WJETSH"
            };

            // Khởi tạo Firebase
            firebase.initializeApp(firebaseConfig);
            const database = firebase.database();
            const auth = firebase.auth();

            // Biến lưu trữ thông tin user hiện tại
            let currentUser = null;

            // Kiểm tra đăng nhập và load dữ liệu
            auth.onAuthStateChanged((user) => {
                if (!user) {
                    Swal.fire({
                        title: 'Vui lòng đăng nhập',
                        text: 'Bạn cần đăng nhập để truy cập trang này',
                        icon: 'warning',
                        confirmButtonText: 'Đăng nhập'
                    }).then(() => {
                        window.location.href = 'index.html';
                    });
                    return;
                }

                currentUser = user;
                loadUserData(user);
                loadOrders(user.uid);
                updateAuthButtons(user);
            });

            // Load thông tin user
            function loadUserData(user) {
                try {
                    document.getElementById('userName').textContent = user.displayName || 'Chưa cập nhật';
                    document.getElementById('userEmail').textContent = user.email;

                    // Load thông tin chi tiết từ database
                    database.ref('users/' + user.uid).once('value')
                        .then((snapshot) => {
                            const userData = snapshot.val();
                            if (userData) {
                                document.getElementById('fullName').value = userData.displayName || '';
                                document.getElementById('phone').value = userData.phone || '';
                                document.getElementById('email').value = user.email;
                                document.getElementById('address').value = userData.address || '';
                                document.getElementById('city').value = userData.city || '';
                                document.getElementById('district').value = userData.district || '';
                            }
                        })
                        .catch((error) => {
                            console.error('Lỗi khi load thông tin user:', error);
                            Swal.fire('Lỗi', 'Không thể tải thông tin người dùng', 'error');
                        });
                } catch (error) {
                    console.error('Lỗi khi xử lý thông tin user:', error);
                    Swal.fire('Lỗi', 'Có lỗi xảy ra khi xử lý thông tin', 'error');
                }
            }

            // Load lịch sử đặt hàng
            function loadOrders(userId) {
                const orderList = document.getElementById('orderList');
                
                try {
                    database.ref('orders').orderByChild('userId').equalTo(userId).on('value', (snapshot) => {
                        const orders = snapshot.val();
                        orderList.innerHTML = '';

                        if (!orders) {
                            orderList.innerHTML = '<p>Bạn chưa có đơn hàng nào</p>';
                            return;
                        }

                        Object.entries(orders).forEach(([orderId, order]) => {
                            if (!order || !order.items) return;

                            const statusClass = {
                                'pending': 'status-pending',
                                'processing': 'status-processing',
                                'completed': 'status-completed',
                                'cancelled': 'status-cancelled'
                            }[order.status] || 'status-pending';

                            const statusText = {
                                'pending': 'Chờ xác nhận',
                                'processing': 'Đang xử lý',
                                'completed': 'Hoàn thành',
                                'cancelled': 'Đã hủy'
                            }[order.status] || 'Chờ xác nhận';

                            const orderDate = new Date(order.createdAt).toLocaleString();

                            let orderItems = '';
                            order.items.forEach(item => {
                                if (!item) return;
                                orderItems += `
                                    <div class="order-item">
                                        <img src="${item.image || 'picture/logo.jpg'}" alt="${item.name || 'Sản phẩm'}" class="item-image">
                                        <div class="item-details">
                                            <h4 class="item-name">${item.name || 'Sản phẩm không xác định'}</h4>
                                            <p class="item-price">${(item.price || 0).toLocaleString()}đ x ${item.quantity || 1}</p>
                                        </div>
                                    </div>
                                `;
                            });

                            orderList.innerHTML += `
                                <div class="order-card">
                                    <div class="order-header">
                                        <span class="order-number">Đơn hàng #${orderId}</span>
                                        <span class="order-status ${statusClass}">${statusText}</span>
                                    </div>
                                    <div class="order-items">
                                        ${orderItems}
                                    </div>
                                    <div class="order-footer">
                                        <span class="order-total">Tổng tiền: ${(order.total || 0).toLocaleString()}đ</span>
                                        <div class="order-actions">
                                            <button class="btn btn-outline" onclick="viewOrderDetail('${orderId}')">Chi tiết</button>
                                            ${order.status === 'pending' ? `
                                                <button class="btn btn-outline" onclick="cancelOrder('${orderId}')">Hủy đơn</button>
                                            ` : ''}
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                    }, (error) => {
                        console.error('Lỗi khi load đơn hàng:', error);
                        Swal.fire('Lỗi', 'Không thể tải lịch sử đơn hàng', 'error');
                    });
                } catch (error) {
                    console.error('Lỗi khi xử lý đơn hàng:', error);
                    Swal.fire('Lỗi', 'Có lỗi xảy ra khi xử lý đơn hàng', 'error');
                }
            }

            // Cập nhật thông tin cá nhân
            function updateProfile(event) {
                event.preventDefault();
                if (!currentUser) return;

                const fullName = document.getElementById('fullName').value.trim();
                const phone = document.getElementById('phone').value.trim();

                if (!fullName) {
                    Swal.fire('Lỗi', 'Vui lòng nhập họ tên', 'error');
                    return;
                }

                if (!phone) {
                    Swal.fire('Lỗi', 'Vui lòng nhập số điện thoại', 'error');
                    return;
                }

                // Validate phone number
                const phoneRegex = /^[0-9]{10,11}$/;
                if (!phoneRegex.test(phone)) {
                    Swal.fire('Lỗi', 'Số điện thoại không hợp lệ', 'error');
                    return;
                }

                const userData = {
                    displayName: fullName,
                    phone: phone
                };

                // Show loading
                Swal.fire({
                    title: 'Đang cập nhật...',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                database.ref('users/' + currentUser.uid).update(userData)
                    .then(() => {
                        // Update display name in auth
                        return currentUser.updateProfile({
                            displayName: fullName
                        });
                    })
                    .then(() => {
                        Swal.fire('Thành công', 'Thông tin đã được cập nhật', 'success');
                        loadUserData(currentUser);
                    })
                    .catch((error) => {
                        console.error('Lỗi khi cập nhật thông tin:', error);
                        Swal.fire('Lỗi', 'Không thể cập nhật thông tin', 'error');
                    });
            }

            // Cập nhật địa chỉ
            function updateAddress(event) {
                event.preventDefault();
                if (!currentUser) return;

                const address = document.getElementById('address').value.trim();
                const city = document.getElementById('city').value.trim();
                const district = document.getElementById('district').value.trim();

                if (!address || !city || !district) {
                    Swal.fire('Lỗi', 'Vui lòng điền đầy đủ thông tin địa chỉ', 'error');
                    return;
                }

                const addressData = {
                    address: address,
                    city: city,
                    district: district
                };

                // Show loading
                Swal.fire({
                    title: 'Đang cập nhật...',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                database.ref('users/' + currentUser.uid).update(addressData)
                    .then(() => {
                        Swal.fire('Thành công', 'Địa chỉ đã được cập nhật', 'success');
                    })
                    .catch((error) => {
                        console.error('Lỗi khi cập nhật địa chỉ:', error);
                        Swal.fire('Lỗi', 'Không thể cập nhật địa chỉ', 'error');
                    });
            }

            // Đổi mật khẩu
            function updatePassword(event) {
                event.preventDefault();
                if (!currentUser) return;

                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;

                if (!currentPassword || !newPassword || !confirmPassword) {
                    Swal.fire('Lỗi', 'Vui lòng điền đầy đủ thông tin', 'error');
                    return;
                }

                if (newPassword !== confirmPassword) {
                    Swal.fire('Lỗi', 'Mật khẩu xác nhận không khớp', 'error');
                    return;
                }

                if (newPassword.length < 6) {
                    Swal.fire('Lỗi', 'Mật khẩu mới phải có ít nhất 6 ký tự', 'error');
                    return;
                }

                // Show loading
                Swal.fire({
                    title: 'Đang xử lý...',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                // Reauthenticate user
                const credential = firebase.auth.EmailAuthProvider.credential(
                    currentUser.email,
                    currentPassword
                );

                currentUser.reauthenticateWithCredential(credential)
                    .then(() => {
                        return currentUser.updatePassword(newPassword);
                    })
                    .then(() => {
                        Swal.fire('Thành công', 'Mật khẩu đã được cập nhật', 'success');
                        document.getElementById('passwordForm').reset();
                    })
                    .catch((error) => {
                        console.error('Lỗi khi đổi mật khẩu:', error);
                        if (error.code === 'auth/wrong-password') {
                            Swal.fire('Lỗi', 'Mật khẩu hiện tại không đúng', 'error');
                        } else {
                            Swal.fire('Lỗi', 'Không thể cập nhật mật khẩu', 'error');
                        }
                    });
            }

            // Xem chi tiết đơn hàng
            function viewOrderDetail(orderId) {
                if (!orderId) return;

                // Show loading
                Swal.fire({
                    title: 'Đang tải...',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });

                database.ref('orders/' + orderId).once('value')
                    .then((snapshot) => {
                        const order = snapshot.val();
                        if (!order) {
                            throw new Error('Không tìm thấy đơn hàng');
                        }

                        const orderDate = new Date(order.createdAt).toLocaleString();
                        const statusText = {
                            'pending': 'Chờ xác nhận',
                            'processing': 'Đang xử lý',
                            'completed': 'Hoàn thành',
                            'cancelled': 'Đã hủy'
                        }[order.status] || 'Chờ xác nhận';

                        let itemsHtml = '';
                        if (order.items && order.items.length > 0) {
                            itemsHtml = order.items.map(item => `
                                <div style="margin-bottom: 10px;">
                                    <p><strong>${item.name}</strong></p>
                                    <p>Số lượng: ${item.quantity}</p>
                                    <p>Giá: ${item.price.toLocaleString()}đ</p>
                                </div>
                            `).join('');
                        }

                        Swal.fire({
                            title: `Chi tiết đơn hàng #${orderId}`,
                            html: `
                                <div style="text-align: left;">
                                    <p><strong>Ngày đặt:</strong> ${orderDate}</p>
                                    <p><strong>Trạng thái:</strong> ${statusText}</p>
                                    <p><strong>Địa chỉ giao hàng:</strong> ${order.shippingAddress || 'Chưa cập nhật'}</p>
                                    <p><strong>Tổng tiền:</strong> ${(order.total || 0).toLocaleString()}đ</p>
                                    <hr>
                                    <h4>Sản phẩm:</h4>
                                    ${itemsHtml}
                                </div>
                            `,
                            width: '600px'
                        });
                    })
                    .catch((error) => {
                        console.error('Lỗi khi xem chi tiết đơn hàng:', error);
                        Swal.fire('Lỗi', 'Không thể tải thông tin đơn hàng', 'error');
                    });
            }

            // Hủy đơn hàng
            function cancelOrder(orderId) {
                if (!orderId) return;

                Swal.fire({
                    title: 'Xác nhận hủy đơn',
                    text: 'Bạn có chắc chắn muốn hủy đơn hàng này?',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Hủy đơn',
                    cancelButtonText: 'Không'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Show loading
                        Swal.fire({
                            title: 'Đang xử lý...',
                            allowOutsideClick: false,
                            didOpen: () => {
                                Swal.showLoading();
                            }
                        });

                        database.ref('orders/' + orderId).update({
                            status: 'cancelled',
                            cancelledAt: firebase.database.ServerValue.TIMESTAMP
                        }).then(() => {
                            Swal.fire('Thành công', 'Đơn hàng đã được hủy', 'success');
                        }).catch((error) => {
                            console.error('Lỗi khi hủy đơn hàng:', error);
                            Swal.fire('Lỗi', 'Không thể hủy đơn hàng', 'error');
                        });
                    }
                });
            }

            // Hiển thị section
            function showSection(sectionId) {
                if (!sectionId) return;

                // Ẩn tất cả các section
                document.querySelectorAll('.content-section').forEach(section => {
                    section.style.display = 'none';
                });

                // Hiển thị section được chọn
                const selectedSection = document.getElementById(sectionId + 'Section');
                if (selectedSection) {
                    selectedSection.style.display = 'block';
                    // Tải lại lịch sử đơn hàng nếu đang ở tab orders
                    if (sectionId === 'orders') {
                        loadOrderHistory();
                    }
                }

                // Cập nhật active state cho menu
                document.querySelectorAll('.sidebar-menu a').forEach(link => {
                    link.classList.remove('active');
                });
                event.currentTarget.classList.add('active');
            }

            // Đăng xuất
            function logout() {
                Swal.fire({
                    title: 'Xác nhận đăng xuất',
                    text: 'Bạn có chắc chắn muốn đăng xuất?',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: 'Đăng xuất',
                    cancelButtonText: 'Hủy'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Show loading
                        Swal.fire({
                            title: 'Đang đăng xuất...',
                            allowOutsideClick: false,
                            didOpen: () => {
                                Swal.showLoading();
                            }
                        });

                        auth.signOut().then(() => {
                            window.location.href = 'index.html';
                        }).catch((error) => {
                            console.error('Lỗi khi đăng xuất:', error);
                            Swal.fire('Lỗi', 'Không thể đăng xuất', 'error');
                        });
                    }
                });
            }

            // Xử lý lỗi chung
            window.onerror = function(msg, url, lineNo, columnNo, error) {
                console.error('Lỗi:', msg, 'URL:', url, 'Line:', lineNo, 'Column:', columnNo, 'Error:', error);
                return false;
            };

            // Hàm tải lịch sử đơn hàng
            async function loadOrderHistory() {
                try {
                    const user = auth.currentUser;
                    if (!user) return;

                    const ordersRef = database.ref('orders');
                    const snapshot = await ordersRef.orderByChild('email').equalTo(user.email).once('value');
                    const orders = [];
                    
                    snapshot.forEach((childSnapshot) => {
                        const orderData = childSnapshot.val();
                        orders.push({
                            id: childSnapshot.key,
                            ...orderData
                        });
                    });

                    // Sắp xếp đơn hàng theo thời gian tạo (mới nhất lên đầu)
                    orders.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

                    const orderList = document.getElementById('orderList');
                    orderList.innerHTML = orders.length ? '' : '<p>Bạn chưa có đơn hàng nào</p>';

                    orders.forEach(order => {
                        const orderElement = createOrderElement(order);
                        orderList.appendChild(orderElement);
                    });
                } catch (error) {
                    console.error('Lỗi khi tải lịch sử đơn hàng:', error);
                    showError('Lỗi', 'Không thể tải lịch sử đơn hàng. Vui lòng thử lại sau.');
                }
            }

            // Hàm tạo element đơn hàng
            function createOrderElement(order) {
                const div = document.createElement('div');
                div.className = 'order-item';
                div.onclick = () => showOrderDetail(order);

                const statusClass = getStatusClass(order.status);
                const statusText = getStatusText(order.status);
                const orderDate = new Date(order.createdAt).toLocaleDateString('vi-VN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                div.innerHTML = `
                    <div class="order-header">
                        <div>
                            <span class="order-id">Đơn hàng #${order.orderId}</span>
                            <span class="order-date">${orderDate}</span>
                        </div>
                        <span class="order-status ${statusClass}">${statusText}</span>
                    </div>
                    <div class="order-summary">
                        <div class="summary-item">
                            <span class="summary-label">Người nhận</span>
                            <span class="summary-value">${order.fullName}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Số điện thoại</span>
                            <span class="summary-value">${order.phone}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Địa chỉ</span>
                            <span class="summary-value">${order.address}</span>
                        </div>
                    </div>
                    <div class="order-total">
                        Tổng tiền: ${order.grandTotal.toLocaleString('vi-VN')}đ
                    </div>
                `;

                return div;
            }

            // Hàm hiển thị chi tiết đơn hàng
            function showOrderDetail(order) {
                const modal = document.getElementById('orderDetailModal');
                const content = document.getElementById('orderDetailContent');

                const orderDate = new Date(order.createdAt).toLocaleDateString('vi-VN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                const paymentDate = order.paymentDate ? new Date(order.paymentDate).toLocaleDateString('vi-VN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }) : 'Chưa thanh toán';

                content.innerHTML = `
                    <div class="order-detail-section">
                        <h3>Thông tin đơn hàng</h3>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <span class="detail-label">Mã đơn hàng</span>
                                <span class="detail-value">${order.orderId}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Mã giao dịch</span>
                                <span class="detail-value">${order.orderKey}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Ngày đặt</span>
                                <span class="detail-value">${orderDate}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Trạng thái</span>
                                <span class="detail-value">${getStatusText(order.status)}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Phương thức thanh toán</span>
                                <span class="detail-value">${order.paymentMethod === 'vnpay' ? 'VNPAY' : 'Thanh toán khi nhận hàng'}</span>
                            </div>
                        </div>
                    </div>

                    <div class="order-detail-section">
                        <h3>Thông tin người nhận</h3>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <span class="detail-label">Họ và tên</span>
                                <span class="detail-value">${order.fullName}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Số điện thoại</span>
                                <span class="detail-value">${order.phone}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Email</span>
                                <span class="detail-value">${order.email}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Địa chỉ</span>
                                <span class="detail-value">${order.address}</span>
                            </div>
                        </div>
                    </div>

                    <div class="order-detail-section">
                        <h3>Sản phẩm</h3>
                        <div class="product-list">
                            ${order.items && order.items.length > 0 ? order.items.map(item => `
                                <div class="product-item">
                                    <img src="${item.image || 'picture/logo.jpg'}" alt="${item.name || 'Sản phẩm'}" class="product-image">
                                    <div class="product-info">
                                        <div class="product-name">${item.name || 'Sản phẩm không xác định'}</div>
                                        <div class="product-price">${(item.price || 0).toLocaleString('vi-VN')}đ</div>
                                        <div class="product-quantity">Số lượng: ${item.quantity || 1}</div>
                                    </div>
                                </div>
                            `).join('') : '<p>Không có thông tin sản phẩm</p>'}
                        </div>
                    </div>

                    ${order.paymentMethod === 'vnpay' ? `
                        <div class="order-detail-section">
                            <h3>Thông tin thanh toán</h3>
                            <div class="payment-info">
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <span class="detail-label">Mã giao dịch VNPAY</span>
                                        <span class="detail-value">${order.paymentDetails.transactionNo}</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Mã giao dịch ngân hàng</span>
                                        <span class="detail-value">${order.paymentDetails.bankTranNo}</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Ngân hàng</span>
                                        <span class="detail-value">${order.paymentDetails.bankCode}</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Thời gian thanh toán</span>
                                        <span class="detail-value">${paymentDate}</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Trạng thái thanh toán</span>
                                        <span class="detail-value">${order.paymentStatus === 'completed' ? 'Hoàn thành' : 'Chưa hoàn thành'}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ` : ''}

                    <div class="order-detail-section">
                        <h3>Tổng thanh toán</h3>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <span class="detail-label">Tạm tính</span>
                                <span class="detail-value">${(order.subtotal || 0).toLocaleString('vi-VN')}đ</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Phí vận chuyển</span>
                                <span class="detail-value">${(order.shipping || 0).toLocaleString('vi-VN')}đ</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Tổng cộng</span>
                                <span class="detail-value" style="color: var(--primary-color); font-weight: 600;">
                                    ${(order.grandTotal || 0).toLocaleString('vi-VN')}đ
                                </span>
                            </div>
                        </div>
                    </div>

                    <div class="order-detail-section">
                        <h3>Lịch sử đơn hàng</h3>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-date">${orderDate}</div>
                                <div class="timeline-content">Đơn hàng được tạo</div>
                            </div>
                            ${order.paymentDate ? `
                                <div class="timeline-item">
                                    <div class="timeline-date">${paymentDate}</div>
                                    <div class="timeline-content">Thanh toán thành công</div>
                                </div>
                            ` : ''}
                            ${order.status === 'completed' && order.updatedAt ? `
                                <div class="timeline-item">
                                    <div class="timeline-date">${new Date(order.updatedAt).toLocaleDateString('vi-VN')}</div>
                                    <div class="timeline-content">Đơn hàng hoàn thành</div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;

                modal.style.display = 'block';
            }

            // Hàm lấy class cho trạng thái
            function getStatusClass(status) {
                switch (status) {
                    case 'pending': return 'status-pending';
                    case 'paid': return 'status-paid';
                    case 'shipping': return 'status-shipping';
                    case 'completed': return 'status-completed';
                    case 'cancelled': return 'status-cancelled';
                    default: return '';
                }
            }

            // Hàm lấy text cho trạng thái
            function getStatusText(status) {
                switch (status) {
                    case 'pending': return 'Chờ thanh toán';
                    case 'paid': return 'Đã thanh toán';
                    case 'shipping': return 'Đang giao hàng';
                    case 'completed': return 'Hoàn thành';
                    case 'cancelled': return 'Đã hủy';
                    default: return 'Không xác định';
                }
            }

            // Thêm vào hàm initMemberPage
            function initMemberPage() {
                const user = auth.currentUser;
                if (user) {
                    document.getElementById('userName').textContent = user.displayName || 'Chưa cập nhật';
                    document.getElementById('userEmail').textContent = user.email;
                    loadUserData(user);
                    loadOrderHistory();
                }
            }

            // Hàm đóng modal
            function closeModal(modalId) {
                document.getElementById(modalId).style.display = 'none';
            }

            // Hàm in đơn hàng
            function printOrder() {
                window.print();
            }

            // Đóng modal khi click bên ngoài
            window.onclick = function(event) {
                const modal = document.getElementById('orderDetailModal');
                if (event.target === modal) {
                    closeModal('orderDetailModal');
                }
            }

            // Hàm cập nhật nút đăng nhập/đăng xuất
            function updateAuthButtons(user) {
                const authButtons = document.getElementById('authButtons');
                if (user) {
                    authButtons.innerHTML = `
                        <div class="user-menu" onclick="confirmLogout()">
                            <span>👤</span>
                            <span>${user.email}</span>
                        </div>
                    `;
                } else {
                    authButtons.innerHTML = `
                        <a href="#" class="login-btn" onclick="showModal('loginModal')">
                            <span>👤</span>
                            <span>Đăng nhập</span>
                        </a>
                    `;
                }
            }

            // Hàm xác nhận đăng xuất
            function confirmLogout() {
                Swal.fire({
                    title: 'Xác nhận đăng xuất',
                    text: 'Bạn có chắc chắn muốn đăng xuất?',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: 'Đăng xuất',
                    cancelButtonText: 'Hủy'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Show loading
                        Swal.fire({
                            title: 'Đang đăng xuất...',
                            allowOutsideClick: false,
                            didOpen: () => {
                                Swal.showLoading();
                            }
                        });

                        auth.signOut().then(() => {
                            window.location.href = 'index.html';
                        }).catch((error) => {
                            console.error('Lỗi khi đăng xuất:', error);
                            Swal.fire('Lỗi', 'Không thể đăng xuất', 'error');
                        });
                    }
                });
            }
        </script>
          <script src="https://app.tudongchat.com/js/chatbox.js"></script>
          <script>
            const tudong_chatbox = new TuDongChat('fvnnpQFt5lp13VAR7GEiK')
            tudong_chatbox.initial()
          </script>
    </body>
</html> 